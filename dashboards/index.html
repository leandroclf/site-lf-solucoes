<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LF Soluções | Dashboard Operacional</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="topbar">
      <h1>Dashboard Operacional — LF Soluções</h1>
      <a href="../index.html" class="btn">← Voltar ao site</a>
    </header>

    <main class="container">
      <section class="card">
        <div class="section-head">
          <h2>Camada Estratégica — Status Geral</h2>
          <div class="view-switch">
            <button id="view-executive" class="btn btn-secondary" type="button">Visão Executiva</button>
            <button id="view-operational" class="btn btn-secondary" type="button">Visão Operacional</button>
          </div>
        </div>
        <p id="last-updated-global" class="task-meta">Última atualização: carregando...</p>
        <p id="immediate-action-badge" class="task-meta">Ação imediata: avaliando...</p>
        <section class="grid metrics metrics-5">
          <article class="card kpi" id="kpi-jobs-ativos" title="Quantidade total de jobs ativos no cron">
            <h3>Total de Jobs Ativos</h3>
            <p class="big" id="metric-jobs">—</p>
            <p class="task-meta" id="metric-jobs-meta">Meta: >= 8</p>
            <p class="task-meta" id="metric-jobs-var">Variação: n/d</p>
          </article>
          <article class="card kpi" id="kpi-jobs-atrasados" title="Jobs com falha/erro no último ciclo conhecido">
            <h3>Jobs Atrasados</h3>
            <p class="big" id="metric-jobs-delayed">—</p>
            <p class="task-meta" id="metric-jobs-delayed-meta">Meta: 0</p>
            <p class="task-meta" id="metric-jobs-delayed-var">Variação: n/d</p>
          </article>
          <article class="card kpi" id="kpi-sla" title="SLA médio atual do autopilot e operação">
            <h3>SLA Médio Atual (%)</h3>
            <p class="big" id="metric-sla-current">—</p>
            <p class="task-meta" id="metric-sla-meta">Meta: >= 95%</p>
            <p class="task-meta" id="metric-sla-var">Variação: n/d</p>
          </article>
          <article class="card kpi" id="kpi-tmr" title="Tempo médio de resolução das atividades concluídas">
            <h3>TMR (h)</h3>
            <p class="big" id="metric-tmr">—</p>
            <p class="task-meta" id="metric-tmr-meta">Meta: <= 24h</p>
            <p class="task-meta" id="metric-tmr-var">Variação: n/d</p>
          </article>
          <article class="card kpi" id="kpi-throughput" title="Throughput semanal com comparação de período anterior">
            <h3>Throughput Semanal</h3>
            <p class="big" id="metric-throughput">—</p>
            <p class="task-meta" id="metric-throughput-meta">Meta: >= 6/semana</p>
            <p class="task-meta" id="metric-throughput-var">Variação: n/d</p>
          </article>
        </section>
      </section>

      <section class="card" data-view="operational">
        <h2>Camada de Alertas e Gargalos</h2>
        <div class="mini-grid">
          <div class="card">
            <h3>Top 5 gargalos</h3>
            <ul id="bottlenecks-list" class="task-list"></ul>
          </div>
          <div class="card">
            <h3>Jobs mais críticos</h3>
            <div id="critical-jobs-bars" class="bars"></div>
          </div>
          <div class="card">
            <h3>SLA violado (24h)</h3>
            <p class="task-meta">Threshold de alerta (h): <input id="alert-threshold-hours" type="number" min="1" value="24" style="width:80px;" /></p>
            <ul id="sla-violations-list" class="task-list"></ul>
          </div>
        </div>
        <div class="mini-grid" style="margin-top:10px;">
          <div class="card">
            <h3>Bloqueios por tipo</h3>
            <ul id="blocked-by-type" class="task-list"></ul>
          </div>
          <div class="card">
            <h3>Heatmap por categoria (volume de bloqueio)</h3>
            <div id="heatmap-categories" class="heatmap-grid"></div>
          </div>
        </div>
      </section>

      <section class="card" data-view="executive operational">
        <h2>Camada Analítica (Tendências)</h2>
        <div class="filters">
          <label>
            Período
            <select id="trend-period">
              <option value="7">7 dias</option>
              <option value="14">14 dias</option>
              <option value="30">30 dias</option>
            </select>
          </label>
          <label>
            Equipe/Categoria
            <select id="trend-team">
              <option value="">Todas</option>
              <option value="produto-receita">Produto e Receita</option>
              <option value="engenharia-arquitetura">Engenharia e Arquitetura</option>
              <option value="plataforma-infra-qualidade">Plataforma/Infra/Qualidade</option>
              <option value="dados-compliance-juridico">Dados/Compliance/Jurídico</option>
              <option value="orquestracao-governanca">Orquestração/Governança</option>
            </select>
          </label>
        </div>
        <div class="mini-grid">
          <div class="card"><h3>Volume de atividades</h3><div id="trend-volume" class="trend-box"></div></div>
          <div class="card"><h3>SLA médio (%)</h3><div id="trend-sla" class="trend-box"></div></div>
          <div class="card"><h3>TMR (h)</h3><div id="trend-tmr" class="trend-box"></div></div>
        </div>
        <div class="mini-grid" style="margin-top:10px;">
          <div class="card"><h3>Status empilhado</h3><div id="trend-status-stacked" class="stacked-bar"></div><p id="trend-status-label" class="task-meta">—</p></div>
          <div class="card"><h3>Retrabalho (histórico)</h3><div id="trend-rework" class="trend-box"></div></div>
          <div class="card"><h3>Risco humano (histórico)</h3><div id="trend-human-risk" class="trend-box"></div></div>
        </div>
        <div class="mini-grid" style="margin-top:10px;">
          <div class="card"><h3>Outliers de resolução</h3><ul id="tmr-outliers" class="task-list"></ul></div>
        </div>
      </section>

      <section class="card" data-view="executive operational">
        <h2>Semáforo operacional</h2>
        <div class="traffic-wrap">
          <span id="traffic-dot" class="traffic-dot traffic-green" aria-label="Semáforo"></span>
          <p id="traffic-label" class="big">Verde — Operação saudável</p>
        </div>
        <p id="traffic-reason" class="task-meta">Sem bloqueios críticos no filtro atual.</p>
        <p id="traffic-consecutive" class="task-meta">Dias consecutivos em vermelho: 0</p>
        <div>
          <p class="task-meta">Histórico (últimos 7 dias)</p>
          <div id="traffic-history" class="traffic-history"></div>
        </div>
        <div>
          <p class="task-meta">Tendência semanal de risco</p>
          <div id="traffic-trend" class="stacked-bar" aria-label="Tendência semanal"></div>
          <p id="traffic-trend-label" class="task-meta">-</p>
        </div>
      </section>

      <section class="card">
        <h2>SLA HUMAN (v1)</h2>
        <p id="sla-weekly" class="task-meta">Cumprimento semanal: carregando...</p>
        <div id="sla-weekly-bars" class="bars"></div>
        <div class="mini-grid">
          <div class="card">
            <h3>Revisão técnica/documental</h3>
            <p class="task-meta">Alvo: 24h</p>
            <p id="sla-review" class="big">—</p>
          </div>
          <div class="card">
            <h3>Execução padrão</h3>
            <p class="task-meta">Alvo: 72h</p>
            <p id="sla-exec" class="big">—</p>
          </div>
          <div class="card">
            <h3>Desbloqueio crítico</h3>
            <p class="task-meta">Alvo: 24h (escalona em 8h)</p>
            <p id="sla-unblock" class="big">—</p>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Analytics avançado de atividades HUMAN</h2>
        <p id="ops-analytics-updated" class="task-meta">Atualizado em: carregando...</p>
        <div class="mini-grid">
          <div class="card">
            <h3>Lead time médio</h3>
            <p id="ops-lead-time" class="big">—</p>
            <p class="task-meta">Criação → conclusão</p>
          </div>
          <div class="card">
            <h3>Throughput semanal</h3>
            <p id="ops-throughput" class="big">—</p>
            <p class="task-meta">Concluídas por período</p>
          </div>
          <div class="card">
            <h3>Taxa de retrabalho</h3>
            <p id="ops-rework" class="big">—</p>
            <p class="task-meta">Reabertas / concluídas</p>
          </div>
        </div>
        <div class="mini-grid" style="margin-top:10px;">
          <div class="card">
            <h3>Índice de risco humano</h3>
            <p id="ops-risk-score" class="big">—</p>
            <p id="ops-risk-trend" class="task-meta">Tendência: —</p>
          </div>
          <div class="card">
            <h3>Carga cognitiva</h3>
            <p id="ops-cognitive" class="big">—</p>
            <p class="task-meta">Esforço ponderado por analista</p>
          </div>
          <div class="card">
            <h3>Qualidade de execução</h3>
            <p id="ops-quality" class="big">—</p>
            <p class="task-meta">Reabertura + incidentes</p>
          </div>
        </div>
        <div class="handoff-block" style="margin-top:10px;">
          <h3>Alertas preditivos</h3>
          <ul id="ops-predictive-alerts"></ul>
        </div>

        <div class="mini-grid" style="margin-top:10px;">
          <div class="card">
            <h3>Saúde do Autopilot (24h)</h3>
            <p id="autopilot-completion" class="big">—</p>
            <p id="autopilot-runs" class="task-meta">Runs: —</p>
          </div>
          <div class="card">
            <h3>Duração média do ciclo</h3>
            <p id="autopilot-duration" class="big">—</p>
            <p id="autopilot-interruptions" class="task-meta">Interrupções: —</p>
          </div>
          <div class="card">
            <h3>Intervenção humana</h3>
            <p id="autopilot-human" class="big">—</p>
            <p id="autopilot-updated" class="task-meta">Atualizado em: —</p>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Deploy / CI Health</h2>
        <p id="deploy-status-updated" class="task-meta">Atualizado em: carregando...</p>
        <p id="deploy-aggregate" class="task-meta">Semáforo agregado: —</p>
        <ul id="deploy-status-list" class="task-list"></ul>
      </section>

      <section class="card" id="freshness-card">
        <h2>Confiabilidade do Dashboard</h2>
        <p id="freshness-summary" class="task-meta">Carregando...</p>
        <ul id="freshness-list" class="task-list"></ul>
      </section>

      <section class="card" id="human-sla-card">
        <h2>SLA de decisões HUMAN (011/012)</h2>
        <p id="human-sla-summary" class="task-meta">Carregando...</p>
        <ul id="human-sla-list" class="task-list"></ul>
      </section>

      <section class="card">
        <h2>Resumo visual</h2>
        <div class="mini-grid">
          <div>
            <p class="task-meta">AUTO vs HUMAN</p>
            <div id="chart-mode" class="stacked-bar" aria-label="AUTO vs HUMAN"></div>
            <p id="chart-mode-label" class="task-meta">-</p>
          </div>
          <div>
            <p class="task-meta">Prioridade</p>
            <div id="chart-priority" class="stacked-bar" aria-label="Prioridades"></div>
            <p id="chart-priority-label" class="task-meta">-</p>
          </div>
          <div>
            <p class="task-meta">Top responsáveis</p>
            <div id="chart-owners" class="bars" aria-label="Top responsáveis"></div>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Pontos de controle (fonte de verdade)</h2>
        <ul>
          <li>Autopilot contínuo com foco em produto e evidência por ciclo</li>
          <li>Watchdog anti-ociosidade com mini-ciclo automático</li>
          <li>Auditoria Deploy/CI e auditoria GitFlow diárias</li>
          <li>Auditoria de onboarding de especialistas diária</li>
          <li>KPI de SLA do autopilot + rotação de summary</li>
        </ul>
      </section>

      <section class="grid two">
        <article class="card">
          <h2>Job principal (autopilot)</h2>
          <ul>
            <li>24/7 (a cada 30 min, UTC/BRT)</li>
            <li>Retry automático para falhas transitórias (até 2x)</li>
            <li>Interrompe apenas com HARD_BLOCKER/HUMAN_BLOCKER persistente</li>
            <li>Avisa humano somente quando intervenção é necessária</li>
          </ul>
        </article>
        <article class="card">
          <h2>Cadências e auditorias</h2>
          <ul>
            <li>Semanal (Seg 12:00–14:59 UTC / 09:00–11:59 BRT)</li>
            <li>Quinzenal — revisão SLA (>=14 dias)</li>
            <li>Mensal (dia 1, 15:00–15:59 UTC / 12:00–12:59 BRT)</li>
            <li>Onboarding/GitFlow/SLA/rotation em horários de governança (UTC), com operação principal 24/7</li>
          </ul>
        </article>
      </section>

      <section class="card">
        <div class="section-head">
          <h2>Kanban de atividades</h2>
          <span class="badge">Visão consolidada para acompanhamento</span>
          <span class="badge">HUMAN com runbook detalhado</span>
        </div>
        <div class="filters">
          <label>
            Responsável
            <select id="filter-owner">
              <option value="">Todos</option>
            </select>
          </label>
          <label>
            Prioridade
            <select id="filter-priority">
              <option value="">Todas</option>
              <option value="Alta">Alta</option>
              <option value="Média">Média</option>
              <option value="Baixa">Baixa</option>
            </select>
          </label>
          <label>
            Projeto
            <select id="filter-project">
              <option value="">Todos</option>
            </select>
          </label>
          <label>
            Modo
            <select id="filter-mode">
              <option value="">Todos</option>
              <option value="AUTO">AUTO</option>
              <option value="HUMAN">HUMAN</option>
            </select>
          </label>
          <label class="search-wrap">
            Busca
            <input id="filter-search" type="text" placeholder="Buscar por issue, descrição ou responsável" />
          </label>
          <button id="clear-filters" class="btn btn-secondary" type="button">Limpar filtros</button>
        </div>
        <p id="kanban-updated-at" class="task-meta">Atualizado em: carregando...</p>
        <p id="kanban-summary" class="task-meta">Resumo: carregando...</p>
        <p id="kanban-autorefresh" class="task-meta">Auto-refresh: ativo (a cada 3 min)</p>
        <div id="kanban-board" class="kanban"></div>
        <div class="actions-row">
          <button id="download-weekly-report" class="btn btn-secondary" type="button">Baixar resumo semanal (.txt)</button>
        </div>
      </section>

      <section class="card">
        <div class="section-head">
          <h2>Handoff para analista (contexto completo)</h2>
          <button id="download-handoff" class="btn btn-secondary" type="button">Baixar handoff (.txt)</button>
        </div>
        <p id="handoff-updated" class="task-meta">Atualizado em: carregando...</p>
        <div id="handoff-content" class="handoff"></div>
      </section>
    </main>
    <script src="./script.js" defer></script>
  </body>
</html>
