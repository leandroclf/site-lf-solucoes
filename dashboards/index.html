<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LF Soluções | Dashboard Operacional</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="topbar">
      <h1>Dashboard Operacional — LF Soluções</h1>
      <a href="../index.html" class="btn">← Voltar ao site</a>
    </header>

    <main class="container">
      <section class="grid metrics">
        <article class="card"><h3>Jobs ativos (cron)</h3><p class="big" id="metric-jobs">8</p></article>
        <article class="card"><h3>Pendências HUMAN</h3><p class="big" id="metric-human">0</p></article>
        <article class="card"><h3>HUMAN sem runbook</h3><p class="big" id="metric-blocked">0</p></article>
      </section>

      <section class="card">
        <h2>Semáforo operacional</h2>
        <div class="traffic-wrap">
          <span id="traffic-dot" class="traffic-dot traffic-green" aria-label="Semáforo"></span>
          <p id="traffic-label" class="big">Verde — Operação saudável</p>
        </div>
        <p id="traffic-reason" class="task-meta">Sem bloqueios críticos no filtro atual.</p>
        <p id="traffic-consecutive" class="task-meta">Dias consecutivos em vermelho: 0</p>
        <div>
          <p class="task-meta">Histórico (últimos 7 dias)</p>
          <div id="traffic-history" class="traffic-history"></div>
        </div>
        <div>
          <p class="task-meta">Tendência semanal de risco</p>
          <div id="traffic-trend" class="stacked-bar" aria-label="Tendência semanal"></div>
          <p id="traffic-trend-label" class="task-meta">-</p>
        </div>
      </section>

      <section class="card">
        <h2>SLA HUMAN (v1)</h2>
        <p id="sla-weekly" class="task-meta">Cumprimento semanal: carregando...</p>
        <div id="sla-weekly-bars" class="bars"></div>
        <div class="mini-grid">
          <div class="card">
            <h3>Revisão técnica/documental</h3>
            <p class="task-meta">Alvo: 24h</p>
            <p id="sla-review" class="big">—</p>
          </div>
          <div class="card">
            <h3>Execução padrão</h3>
            <p class="task-meta">Alvo: 72h</p>
            <p id="sla-exec" class="big">—</p>
          </div>
          <div class="card">
            <h3>Desbloqueio crítico</h3>
            <p class="task-meta">Alvo: 24h (escalona em 8h)</p>
            <p id="sla-unblock" class="big">—</p>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Analytics avançado de atividades HUMAN</h2>
        <p id="ops-analytics-updated" class="task-meta">Atualizado em: carregando...</p>
        <div class="mini-grid">
          <div class="card">
            <h3>Lead time médio</h3>
            <p id="ops-lead-time" class="big">—</p>
            <p class="task-meta">Criação → conclusão</p>
          </div>
          <div class="card">
            <h3>Throughput semanal</h3>
            <p id="ops-throughput" class="big">—</p>
            <p class="task-meta">Concluídas por período</p>
          </div>
          <div class="card">
            <h3>Taxa de retrabalho</h3>
            <p id="ops-rework" class="big">—</p>
            <p class="task-meta">Reabertas / concluídas</p>
          </div>
        </div>
        <div class="mini-grid" style="margin-top:10px;">
          <div class="card">
            <h3>Índice de risco humano</h3>
            <p id="ops-risk-score" class="big">—</p>
            <p id="ops-risk-trend" class="task-meta">Tendência: —</p>
          </div>
          <div class="card">
            <h3>Carga cognitiva</h3>
            <p id="ops-cognitive" class="big">—</p>
            <p class="task-meta">Esforço ponderado por analista</p>
          </div>
          <div class="card">
            <h3>Qualidade de execução</h3>
            <p id="ops-quality" class="big">—</p>
            <p class="task-meta">Reabertura + incidentes</p>
          </div>
        </div>
        <div class="handoff-block" style="margin-top:10px;">
          <h3>Alertas preditivos</h3>
          <ul id="ops-predictive-alerts"></ul>
        </div>

        <div class="mini-grid" style="margin-top:10px;">
          <div class="card">
            <h3>Saúde do Autopilot (24h)</h3>
            <p id="autopilot-completion" class="big">—</p>
            <p id="autopilot-runs" class="task-meta">Runs: —</p>
          </div>
          <div class="card">
            <h3>Duração média do ciclo</h3>
            <p id="autopilot-duration" class="big">—</p>
            <p id="autopilot-interruptions" class="task-meta">Interrupções: —</p>
          </div>
          <div class="card">
            <h3>Intervenção humana</h3>
            <p id="autopilot-human" class="big">—</p>
            <p id="autopilot-updated" class="task-meta">Atualizado em: —</p>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Deploy / CI Health</h2>
        <p id="deploy-status-updated" class="task-meta">Atualizado em: carregando...</p>
        <p id="deploy-aggregate" class="task-meta">Semáforo agregado: —</p>
        <ul id="deploy-status-list" class="task-list"></ul>
      </section>

      <section class="card">
        <h2>SLA de decisões HUMAN (011/012)</h2>
        <p id="human-sla-summary" class="task-meta">Carregando...</p>
        <ul id="human-sla-list" class="task-list"></ul>
      </section>

      <section class="card">
        <h2>Resumo visual</h2>
        <div class="mini-grid">
          <div>
            <p class="task-meta">AUTO vs HUMAN</p>
            <div id="chart-mode" class="stacked-bar" aria-label="AUTO vs HUMAN"></div>
            <p id="chart-mode-label" class="task-meta">-</p>
          </div>
          <div>
            <p class="task-meta">Prioridade</p>
            <div id="chart-priority" class="stacked-bar" aria-label="Prioridades"></div>
            <p id="chart-priority-label" class="task-meta">-</p>
          </div>
          <div>
            <p class="task-meta">Top responsáveis</p>
            <div id="chart-owners" class="bars" aria-label="Top responsáveis"></div>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Pontos de controle</h2>
        <ul>
          <li>Pesquisa de datasets (diário)</li>
          <li>Decisão e backlog (diário)</li>
          <li>Gate de autorização (reviewer-delivery, diário)</li>
          <li>Controle de atividades HUMAN (diário)</li>
          <li>PDCA semanal + KPI de receita + revisão de equipe</li>
        </ul>
      </section>

      <section class="grid two">
        <article class="card">
          <h2>Job principal (autopilot)</h2>
          <ul>
            <li>11:00–22:00 UTC (hora em hora) — ciclo sequencial completo</li>
            <li>Retry automático para falhas transitórias (até 2x)</li>
            <li>Interrompe apenas com HARD_BLOCKER/HUMAN_BLOCKER</li>
            <li>Avisa humano somente quando intervenção é necessária</li>
          </ul>
        </article>
        <article class="card">
          <h2>Cadências acopladas</h2>
          <ul>
            <li>Semanal (Seg 12:00–14:59 UTC) — KPI/risk + PDCA + staffing + skills</li>
            <li>Quinzenal — revisão SLA (>=14 dias)</li>
            <li>Mensal (dia 1, 15:00–15:59 UTC) — portfólio/governança</li>
            <li>22:50 UTC — SLA do autopilot (job de suporte)</li>
          </ul>
        </article>
      </section>

      <section class="card">
        <div class="section-head">
          <h2>Kanban de atividades</h2>
          <span class="badge">Visão consolidada para acompanhamento</span>
          <span class="badge">HUMAN com runbook detalhado</span>
        </div>
        <div class="filters">
          <label>
            Responsável
            <select id="filter-owner">
              <option value="">Todos</option>
            </select>
          </label>
          <label>
            Prioridade
            <select id="filter-priority">
              <option value="">Todas</option>
              <option value="Alta">Alta</option>
              <option value="Média">Média</option>
              <option value="Baixa">Baixa</option>
            </select>
          </label>
          <label>
            Projeto
            <select id="filter-project">
              <option value="">Todos</option>
            </select>
          </label>
          <label>
            Modo
            <select id="filter-mode">
              <option value="">Todos</option>
              <option value="AUTO">AUTO</option>
              <option value="HUMAN">HUMAN</option>
            </select>
          </label>
          <label class="search-wrap">
            Busca
            <input id="filter-search" type="text" placeholder="Buscar por issue, descrição ou responsável" />
          </label>
          <button id="clear-filters" class="btn btn-secondary" type="button">Limpar filtros</button>
        </div>
        <p id="kanban-updated-at" class="task-meta">Atualizado em: carregando...</p>
        <p id="kanban-summary" class="task-meta">Resumo: carregando...</p>
        <p id="kanban-autorefresh" class="task-meta">Auto-refresh: ativo (a cada 3 min)</p>
        <div id="kanban-board" class="kanban"></div>
        <div class="actions-row">
          <button id="download-weekly-report" class="btn btn-secondary" type="button">Baixar resumo semanal (.txt)</button>
        </div>
      </section>

      <section class="card">
        <div class="section-head">
          <h2>Handoff para analista (contexto completo)</h2>
          <button id="download-handoff" class="btn btn-secondary" type="button">Baixar handoff (.txt)</button>
        </div>
        <p id="handoff-updated" class="task-meta">Atualizado em: carregando...</p>
        <div id="handoff-content" class="handoff"></div>
      </section>
    </main>
    <script src="./script.js"></script>
  </body>
</html>
